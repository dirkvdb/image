box: dirkvdb/cxx14
no-response-timeout: 10
build:
    steps:
        - script:
            name: Setup environnement variables
            code: |
                SRC_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
                BUILD_DIR="${SRC_DIR}/build"
                echo "SRC_DIR ${SRC_DIR}"
                echo "BUILD_DIR ${BUILD_DIR}"

        - script:
            name: Install dependencies
            code: |
                sudo apt-get update
                sudo apt-get install libxdg-basedir-dev libjpeg-dev zlib1g-dev
                wget ftp://ftp.simplesystems.org/pub/png//src/libpng15/libpng-1.5.22.tar.gz
                tar xf libpng-1.5.22.tar.gz
                cd libpng-1.5.22
                ./configure --disable-static
                make
                sudo make install

        - script:
            name: Compile Image
            code: |
                cd "${SRC_DIR}"
                git clone -b develop --recursive --single-branch https://github.com/dirkvdb/utils.git ../utils
                mkdir -p "${BUILD_DIR}"
                cd "${BUILD_DIR}"
                cmake -DSTANDALONE=ON -DCMAKE_BUILD_TYPE=Release "${SRC_DIR}"
                make -j8
                make check -j8

        - script:
            name: Run Tests
            code: |
                cd "${BUILD_DIR}"
                make test
